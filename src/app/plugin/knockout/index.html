<html>
	<head>
		<script type="text/javascript" src="../../../lib/knockout.js/knockout-3.3.0.js"></script>
		<script type="text/javascript" src="../../../lib/jquery/jquery-2.1.3.js"></script>
		<script type="text/javascript" src="todo.js"></script>
	</head>
	<body>
		<input data-bind="textInput: item, event: {keypress: onEnter}" />
		<table>
			<thead>
				  <tr><th>Items</th></tr>
			 </thead>
			 <tbody data-bind="foreach: items">
				  <tr>
						<td data-bind="text: name"></td>
				  </tr>
			 </tbody>
		</table>
	</body>
	<script type="text/javascript">

		eval( (function(){

			var ViewModel = function(facade) {
				var self = this;

				self.item = ko.observable('');
				self.items = ko.observableArray();

				var command = facade.getAddItemCommand();

				facade.registerItemAddedCallback( function(item) {
					// Push item into list
					self.items.push( item );

					// clear existing input
					self.item('');
				});

				self.onEnter = function(d,e) {
					if( e.key == "Enter" ) {
						var item = new Item( self.item() );
						command.execute( item );
					}

					return true;
				};
			};
			
			var facade = new TodoListFacade();
			ko.applyBindings( new ViewModel(facade) );
		})() );

	</script>
</html>
